@page "/create"

@inject EntradasHuacalesService entradasHuacalesService
@inject NavigationManager navigationManager
@inject ToastService toastService
@rendermode InteractiveServer

<PageTitle>Registrar Entrada</PageTitle>

<Toasts class="p-3" AutoHide="true" Delay="5000" Placement="ToastsPlacement.TopRight" />

<EditForm Model="EntradaHuacal" OnValidSubmit="Guardar">
	<DataAnnotationsValidator/>

	<div class="container">
		<div class="card shadow-lg">
			@*Header*@
			<div class="card-header text-center">
				<h5 class="card-title">Registrar Entrada</h5>
			</div>

			@*Body*@
			<div class="card-body">
				<div class="mb-3">
					<label class="form-label"><strong>Fecha</strong></label>
					<InputDate class="form-control" @bind-Value="EntradaHuacal.Fecha" />
					<ValidationMessage For="@(() => EntradaHuacal.Fecha)" />
				</div>

				<div class="mb-3">
					<label class="form-label"><strong>Nombre del Cliente</strong></label>
					<InputText class="form-control" @bind-Value="EntradaHuacal.NombreCliente" />
					<ValidationMessage For="@(() => EntradaHuacal.NombreCliente)" />
				</div>

				<div class="mb-3">
					<label class="form-label"><strong>Cantidad</strong></label>
					<InputNumber class="form-control" @bind-Value="EntradaHuacal.Cantidad" />
					<ValidationMessage For="@(() => EntradaHuacal.Cantidad)"/>
				</div>

				<div class="mb-3">
					<label class="form-label"><strong>Precio</strong></label>
					<InputNumber class="form-control" @bind-Value="EntradaHuacal.Precio" />
					<ValidationMessage For="@(() => EntradaHuacal.Precio)" />
				</div>

				<div class="mb-3">
					<label class="form-label"><strong>Importe</strong></label>
					<input type="number" class="form-control" value="@(EntradaHuacal.Cantidad* EntradaHuacal.Precio)" readonly />
				</div>
			</div>

			@*Footer*@
			<div class="card-footer text-center">
				<div class="btn-group">
					<a href="/index" class="btn btn-outline-secondary"><span class="bi bi-arrow-bar-left"/> Volver</a>
					@if(!creado)
					{
						<button type="submit" class="btn btn-outline-success"><span class="bi bi-check-circle" /> Guardar</button>
					}
				</div>
			</div>
		</div>
	</div>
</EditForm>

@code {
	public EntradasHuacales EntradaHuacal { get; set; } = new EntradasHuacales();
	public bool creado { get; set; } = false;

	protected override async Task OnInitializedAsync()
	{
		EntradaHuacal.Fecha = DateTime.Now;
	}

	public async Task Guardar()
	{
		creado = await entradasHuacalesService.Guardar(EntradaHuacal);
		if (creado)
		{
			toastService.ShowSuccess("Entrada registrada correctamente");
		}
		else
		{
			toastService.ShowError("No se pudo registrar la entrada");
		}
	}
}
